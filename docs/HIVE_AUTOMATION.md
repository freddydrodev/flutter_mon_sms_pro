# Hive Automation Setup

This project includes an automated system for managing Hive adapters and registrar files. When you add new models or update existing ones, the system will automatically update all necessary Hive files.

## ğŸš€ Quick Start

### 1. Install Pre-commit Hook (Recommended)

```bash
# Install the pre-commit hook for automatic updates
ln -s ../../scripts/pre_commit_hook.sh .git/hooks/pre-commit
```

### 2. Manual Commands

```bash
# Update Hive registrars and build adapters
make hive-full

# Or use individual commands:
make hive-update    # Update registrar files
make hive-build     # Build adapters
make hive-watch     # Watch for changes
```

## ğŸ“ File Structure

```
lib/models/
â”œâ”€â”€ hive_registrar.dart          # Main registrar (auto-generated)
â”œâ”€â”€ hive_registrar.g.dart        # Generated adapters
â”œâ”€â”€ hive_registrar.g.yaml        # Type mapping
â”œâ”€â”€ init_hive_adapters.dart      # Initialization (auto-generated)
â”œâ”€â”€ auto_hive_registrar.dart     # Auto-registration helper
â””â”€â”€ [your model files]

scripts/
â”œâ”€â”€ update_hive_registrar.dart   # Auto-update script
â””â”€â”€ pre_commit_hook.sh          # Git pre-commit hook

build.yaml                       # Build configuration
Makefile                        # Convenience commands
.vscode/tasks.json              # VS Code tasks
```

## ğŸ”§ How It Works

### 1. Model Detection

The system automatically scans `lib/models/` for:

- Classes that extend `HiveObject`
- Classes with `@HiveType` annotation
- Enums with `@HiveType` annotation

### 2. Automatic Updates

When models are detected, the system updates:

- `hive_registrar.dart` - Adds imports and adapter specs
- `init_hive_adapters.dart` - Adds registration calls
- `hive_registrar.g.dart` - Generated by build_runner
- `hive_registrar.g.yaml` - Generated by build_runner

### 3. Build Process

```bash
# 1. Update registrar files
dart scripts/update_hive_registrar.dart

# 2. Generate adapters
dart run build_runner build --delete-conflicting-outputs
```

## ğŸ› ï¸ Usage

### Adding a New Model

1. **Create your model file** (e.g., `lib/models/new_model.dart`):

```dart
import 'package:hive_ce/hive.dart';

@HiveType(typeId: 30) // Use next available typeId
class NewModel extends HiveObject {
  @HiveField(0)
  final String id;

  @HiveField(1)
  final String name;

  NewModel({required this.id, required this.name});
}
```

2. **The system will automatically detect it** when you:
   - Run `make hive-update`
   - Commit your changes (if pre-commit hook is installed)
   - Run the VS Code task "Hive: Full Update"

### Updating Existing Models

1. **Modify your model** (add/remove fields, change types)
2. **Run the update command**:

```bash
make hive-full
```

### VS Code Integration

Use the built-in tasks:

- `Ctrl+Shift+P` â†’ "Tasks: Run Task"
- Select "Hive: Full Update" for complete update
- Select "Hive: Watch & Build" for continuous watching

## ğŸ”„ Automation Options

### Option 1: Pre-commit Hook (Recommended)

Automatically updates Hive files before each commit:

```bash
ln -s ../../scripts/pre_commit_hook.sh .git/hooks/pre-commit
```

### Option 2: Watch Mode

Continuously watch for changes:

```bash
make hive-watch
# or
dart run build_runner watch --delete-conflicting-outputs
```

### Option 3: Manual Updates

Run when needed:

```bash
make hive-full
```

## ğŸ“‹ Available Commands

| Command            | Description                 |
| ------------------ | --------------------------- |
| `make hive-update` | Update registrar files only |
| `make hive-build`  | Build adapters only         |
| `make hive-watch`  | Watch for changes           |
| `make hive-clean`  | Clean build cache           |
| `make hive-full`   | Update and build            |
| `make dev`         | Start development mode      |

## ğŸ› Troubleshooting

### Build Errors

```bash
# Clean and rebuild
make hive-clean
make hive-full
```

### Type ID Conflicts

If you get type ID conflicts:

1. Check `hive_registrar.g.yaml` for used type IDs
2. Use the next available type ID in your model
3. Run `make hive-full`

### Missing Adapters

If adapters aren't generated:

1. Ensure your model has `@HiveType` annotation
2. Check that it extends `HiveObject` or has proper annotations
3. Run `make hive-update` to refresh registrar files

## ğŸ“ Best Practices

1. **Always use `@HiveType`** annotation on your models
2. **Use unique type IDs** - check `hive_registrar.g.yaml` for used IDs
3. **Use `@HiveField`** annotations for all fields
4. **Install the pre-commit hook** for automatic updates
5. **Run `make hive-full`** after major model changes

## ğŸ”— Related Files

- `build.yaml` - Build runner configuration
- `pubspec.yaml` - Dependencies (hive_ce, build_runner, etc.)
- `lib/models/utils.dart` - Common enums and utilities
- `lib/models/models.dart` - Barrel export file
